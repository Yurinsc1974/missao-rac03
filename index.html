<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Missão RAC 03 – Jogo de Análise de Risco & Perfil</title>
  <style>
    :root{
      --bg:#0b1220; --card:#111a2b; --muted:#a4b1cd; --text:#eaf1ff;
      --accent:#4f9cff; --accent-2:#22d3ee; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.35); --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:400 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
      color:var(--text);
      background:radial-gradient(1200px 800px at 10% -10%, #173057 0%, #0b1220 50%, #090f1a 100%),
                 url('https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=1200&auto=format&fit=crop') center/cover fixed no-repeat;
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:40px 20px 80px; }
    header{ display:flex; align-items:center; gap:12px; margin-bottom:22px; }
    .logo{ width:42px; height:42px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:grid; place-items:center; box-shadow:var(--shadow); }
    .logo span{font-weight:700}
    h1{ font-size:24px; margin:0; letter-spacing:.2px }
    .card{ background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden }
    /* Intro */
    #intro{ padding:28px; display:grid; grid-template-columns: 1.2fr .8fr; gap:20px; align-items:center }
    #intro .lead{ font-size:18px; color:var(--muted) }
    #intro .panel{ background:var(--card); border-radius:12px; padding:20px; }
    label{ display:block; font-weight:600; margin-bottom:8px }
    input[type=text]{ width:100%; padding:12px 14px; border-radius:10px; border:1px solid rgba(255,255,255,.15); background:#0d1526; color:var(--text); outline:none }
    .actions{ display:flex; gap:12px; margin-top:14px }
    button{ appearance:none; border:0; border-radius:10px; padding:12px 18px; color:#06101f; font-weight:700; cursor:pointer }
    .btn-primary{ background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:#06101f }
    .btn-secondary{ background:rgba(255,255,255,.08); color:var(--text) }
    /* Game */
    #game{ display:none; }
    .game-grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap:20px }
    .scene{ position:relative; height:520px; border-radius:var(--radius); overflow:hidden; background:#111; }
    .scene img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:brightness(.5) }
    .scene .progress{ position:absolute; top:14px; left:14px; right:14px; height:10px; border-radius:8px; background:rgba(255,255,255,.12); overflow:hidden; border:1px solid rgba(255,255,255,.15) }
    .scene .bar{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent-2)); transition:width .35s ease }
    .scene .step{ position:absolute; top:36px; left:16px; font-size:12px; color:#d0dcf5 }
    .qa{ background:var(--card); border-radius:var(--radius); padding:20px; display:grid; grid-template-rows: auto 1fr auto; height:520px }
    .question{ font-size:20px; font-weight:700; margin:2px 0 10px }
    .options{ display:grid; gap:10px; overflow:auto; padding-right:6px }
    .opt{ display:flex; align-items:start; gap:10px; padding:12px; border:1px solid rgba(255,255,255,.12); border-radius:12px; background:#0e1729; cursor:pointer; transition:transform .05s ease, border-color .2s ease }
    .opt:hover{ border-color:rgba(255,255,255,.3) }
    .opt input{ transform:scale(1.2); margin-top:2px }
    .qa-footer{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px }
    .pill{ background:rgba(255,255,255,.08); color:var(--muted); font-size:12px; padding:6px 10px; border-radius:999px }
    /* Result */
    #result{ display:none }
    .result-wrap{ display:grid; grid-template-columns: 1.1fr .9fr; gap:20px }
    .hero{ background:linear-gradient(135deg,#0f1b33,#0b1426); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:22px }
    .metrics{ display:grid; grid-template-columns: repeat(2, 1fr); gap:14px; margin-top:10px }
    .metric{ background:#0e1628; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:14px; display:grid; grid-template-columns: 100px 1fr; gap:12px; align-items:center }
    .metric h4{ margin:0 0 6px; font-size:14px; color:#cbd6ee }
    .metric p{ margin:0; color:var(--muted); font-size:13px }
    .viz{ width:100px; height:100px }
    .panel{ background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:18px }
    .list{ margin:0; padding-left:18px; color:var(--muted) }
    .result-actions{ display:flex; gap:12px; margin-top:14px }
    @media (max-width: 900px){
      #intro{ grid-template-columns: 1fr; }
      .game-grid, .result-wrap{ grid-template-columns: 1fr; }
      .scene, .qa{ height:auto }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo"><span>R3</span></div>
      <div>
        <h1>Missão RAC 03 — Jogo de Análise de Risco & Perfil</h1>
        <div style="color:var(--muted); font-size:14px">Responda às situações e descubra seu perfil de risco e atenção.</div>
      </div>
    </header>

    <!-- Intro -->
    <section id="intro" class="card">
      <div>
        <p class="lead">Antes de começar, informe seu nome. Você verá perguntas situacionais de operação e segurança. No fim, geraremos indicadores como <b>Índice de Risco</b>, <b>Consistência</b> e <b>Velocidade de Resposta</b>, além da exportação em CSV.</p>
        <ul class="list">
          <li>Escala interna de 1 (mais conservador) a 5 (mais arrojado).</li>
          <li>Use o mouse ou <kbd>1–4</kbd> para marcar; <kbd>Enter</kbd> avança.</li>
        </ul>
      </div>
      <div class="panel">
        <label for="playerName">Seu nome ou apelido</label>
        <input id="playerName" type="text" placeholder="Ex.: Maria S." />
        <div class="actions">
          <button id="btnStart" class="btn-primary">Iniciar</button>
          <button id="btnDemo" class="btn-secondary" title="Preencher nome e começar">Demo</button>
        </div>
      </div>
    </section>

    <!-- Game -->
    <section id="game" class="game-grid">
      <div class="scene card">
        <div class="progress"><div class="bar" id="progressBar"></div></div>
        <div class="step" id="stepText"></div>
        <img id="sceneImg" alt="Cenário" src=""/>
      </div>
      <div class="qa card">
        <div>
          <div class="pill" id="topic">Cenário</div>
          <div class="question" id="questionText"></div>
        </div>
        <div class="options" id="options"></div>
        <div class="qa-footer">
          <span class="pill" id="timer">00:00</span>
          <div>
            <button id="btnBack" class="btn-secondary">Voltar</button>
            <button id="btnNext" class="btn-primary" disabled>Próximo</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Result -->
    <section id="result">
      <div class="result-wrap">
        <div class="hero">
          <h2 id="thanks"></h2>
          <p class="lead" id="summary"></p>
          <div class="metrics">
            <div class="metric">
              <svg class="viz" viewBox="0 0 100 100" id="gaugeRisk"></svg>
              <div>
                <h4>Índice de Risco</h4>
                <p>Média ponderada das respostas (1 conservador → 5 arrojado).</p>
              </div>
            </div>
            <div class="metric">
              <svg class="viz" viewBox="0 0 100 100" id="gaugeAttention"></svg>
              <div>
                <h4>Consistência (Atenção)</h4>
                <p>Variação entre respostas consecutivas (menor é melhor).</p>
              </div>
            </div>
            <div class="metric">
              <svg class="viz" viewBox="0 0 100 100" id="gaugeSpeed"></svg>
              <div>
                <h4>Velocidade Média</h4>
                <p>Tempo médio por pergunta.</p>
              </div>
            </div>
            <div class="metric">
              <svg class="viz" viewBox="0 0 100 100" id="radar"></svg>
              <div>
                <h4>Radar</h4>
                <p>Resumo visual dos indicadores principais.</p>
              </div>
            </div>
          </div>
          <div class="result-actions">
            <button id="btnCSV" class="btn-primary">Exportar CSV</button>
            <button id="btnReiniciar" class="btn-secondary">Jogar de novo</button>
          </div>
        </div>
        <div class="panel">
          <h3>Suas respostas</h3>
          <ol id="answersList" class="list"></ol>
        </div>
      </div>
    </section>
  </div>

  <script>
  (function(){
    // ------- Dados -------
    const scenarios = [
      { img: 'https://images.unsplash.com/photo-1603791440384-56cd371ee9a7?auto=format&fit=crop&w=1200&q=80',
        topic:'Condução',
        q: '1. Com o uso da marcha correta o que garantimos na operação dos caminhões? Assinale a resposta que melhor exemplifica o seu uso.',
        opt: [
          {t:'Garantimos a dirigibilidade do veículo inclusive com a utilização dos freios auxiliares.', v:1},
          {t:'Garantimos a refrigeração do retarder, em declives longos.', v:2},
          {t:'Melhor força de frenagem pelo freio motor pois a rotação do motor depende da marcha.', v:3},
          {t:'Melhor lubrificação do motor pois a rotação do motor depende da marcha.', v:5},
        ]},
      { img: 'https://eqpro.com.br/wp-content/uploads/2017/08/epi-equipamento-seguranca-equipro-02z.jpg?auto=format&fit=crop&w=1200&q=80',
        topic:'Frenagem',
        q: '2. Quanto ao uso dos freios auxiliares, em pistas escorregadias. Como devemos proceder:',
        opt: [
          {t:'Priorizar o freio de serviço que freia em todas as rodas enquanto os freios auxiliares freiam em 4 rodas em caminhões 6x4 e 8x4.', v:3},
          {t:'Utilizar o freio de serviço que freia em todas as rodas enquanto os freios auxiliares freiam em 4 rodas em caminhões 6x4 e 8x4.', v:1},
          {t:'Priorizar o freio auxiliares que freiam em 4 rodas em caminhões 6x4 e 8x4.', v:5},
          {t:'Utilizar o freio de serviço que freia por pressão de ar exceto nas cuicas duplas.', v:2},
        ]},
      { img: 'https://images.unsplash.com/photo-1573164574572-cb89e39749b4?auto=format&fit=crop&w=1200&q=80',
        topic:'Testes',
        q: '3. Quanto à testagem dos freios, é correto dizer:',
        opt: [
          {t:'O teste de freio em rampa tem o objetivo de avaliar a eficiência do freio de estacionamento.', v:2},
          {t:'No teste de estanqueidade avaliamos fuga de ar dos freios, já o teste de freio em rampa avaliamos a eficiência dos freios de serviço e estacionamento.', v:1},
          {t:'O teste de freio em rampa tem o objetivo de avaliar fuga de ar, como também avaliamos a eficiência dos freios de serviço e estacionamento.', v:3},
          {t:'O teste de estanqueidade dos freios pode ser feito pelos operadores afins de testar os freios.', v:5},
        ]},
      { img: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80',
        topic:'Vias de Acesso',
        q: '4. Para a liberação das vias de acessos, qual o fluxo devemos seguir para a aprovação e liberação?',
        opt: [
          {t:'Preencher o formulário, premissas: NR22 (largura conforme fluxo e maior equipamento), mão única/dupla, manual de estradas (leiras, inclinações e superelevações).', v:1},
          {t:'Preencher o formulário, premissas: NR22 (largura), manual de estradas (leiras, inclinações e superelevações).', v:2},
          {t:'Preencher o formulário, premissas: NR22 (largura), independente do equipamento, manual de estradas (leiras, inclinações e superelevações).', v:3},
          {t:'Apenas preencher o formulário de liberação.', v:5},
        ]},
      { img: 'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=1200&q=80',
        topic:'Escavadeira',
        q: '5. Em operação de escavadeira, para garantir a segurança do operador/máquina, em atividade sobre plataforma, é correto dizer:',
        opt: [
          {t:'Estabilizar a máquina; roda guia para a crista.', v:3},
          {t:'Atentar à altura da plataforma; estabilizar; roda guia para a crista; atentar aos taludes; carregamentos a 45º.', v:1},
          {t:'Mesmo que acima + carregamentos a 90º pela maior disponibilidade de material.', v:2},
          {t:'Mesmo que acima + carregamentos a 90º com escavação sob esteiras.', v:5},
        ]},
      { img: 'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?auto=format&fit=crop&w=1200&q=80',
        topic:'Pressão de Ar',
        q: '6. Quanto à pressão do ar do sistema de freio, podemos afirmar que:',
        opt: [
          {t:'Não operar com 7 bar; falta de ar no freio de serviço → aplicar o de estacionamento.', v:2},
          {t:'Ar do freio de estacionamento acabou (0 bar) → rodas de estacionamento irão frear.', v:5},
          {t:'Falta de ar do freio de serviço → aplicar o de estacionamento gradativamente até parar.', v:3},
          {t:'Pressão ideal 8–10 bar antes de operar; monitorar painel; falta de ar no serviço → aplicar estacionamento gradativamente.', v:1},
        ]},
      { img: 'https://vale.com/documents/d/guest/estrada-de-ferro-vitoria-img-1-png-7?auto=format&fit=crop&w=1200&q=80',
        topic:'Basculamento',
        q: '7. Marque a opção correta que apresenta as regras básicas para basculamento.',
        opt: [
          {t:'Observar obstáculos e piso; afastamento da crista; verificar inclinômetro e não bascular próximo ao máximo permitido.', v:2},
          {t:'Somente em locais liberados; observar piso e leiras; afastamento da crista; checar inclinômetro; evitar valores próximos do máximo, reposicionando o caminhão.', v:1},
          {t:'Basculamento só em praças de deposição com piso firme.', v:5},
          {t:'Verificar inclinação (4º lateral / 6º frontal); acionar tomada de força e de ar; acompanhar até último estágio; puxar a frente sem bater a tampa.', v:3},
        ]},
      { img: 'https://images.unsplash.com/photo-1501706362039-c06b2d715385?auto=format&fit=crop&w=1200&q=80',
        topic:'Condição Insegura',
        q: '8. Diante de uma condição insegura durante a operação, qual ação você toma?',
        opt: [
          {t:'Parar o caminhão em local seguro e informar a liderança imediatamente.', v:5},
          {t:'Marcar no emociograma e aguardar entrarem em contato com você.', v:1},
          {t:'Procurar o Pitstop parando o equipamento em local seguro.', v:4},
          {t:'Realizar o direito de recusa.', v:2},
        ]},
    ];

    // ------- Estado/elementos/utilitários -------
    let player = '', step = 0, answers = [], times = [], t0 = 0, raf = 0;
    const $ = s => document.querySelector(s);
    const intro = $('#intro'), game = $('#game'), result = $('#result');
    const nameInput = $('#playerName'), btnStart = $('#btnStart'), btnDemo = $('#btnDemo');
    const btnBack = $('#btnBack'), btnNext = $('#btnNext'), progressBar = $('#progressBar');
    const stepText = $('#stepText'), sceneImg = $('#sceneImg'), topic = $('#topic');
    const questionText = $('#questionText'), options = $('#options'), timer = $('#timer');
    const thanks = $('#thanks'), summary = $('#summary'), answersList = $('#answersList');
    const btnCSV = $('#btnCSV'), btnReiniciar = $('#btnReiniciar');

    const fmtTime = ms => { const s = Math.round(ms/1000); const m = String(Math.floor(s/60)).padStart(2,'0'); const ss = String(s%60).padStart(2,'0'); return `${m}:${ss}`; };
    function drawDonut(id,percent,color){ const el=document.getElementById(id); const p=Math.max(0,Math.min(100,percent)); const r=42,c=2*Math.PI*r,off=c*(1-p/100);
      el.innerHTML = `<circle cx="50" cy="50" r="46" fill="none" stroke="rgba(255,255,255,.07)" stroke-width="8"/>
        <circle cx="50" cy="50" r="${r}" fill="none" stroke="${color}" stroke-width="8" stroke-linecap="round" stroke-dasharray="${c}" stroke-dashoffset="${off}" transform="rotate(-90 50 50)"/>
        <text x="50" y="54" text-anchor="middle" font-size="18" fill="#eaf1ff" font-weight="700">${Math.round(p)}%</text>`;
    }
    function drawRadar(id, axes){
      const el = document.getElementById(id), cx=50, cy=50, r=40, ang=[-90,30,150].map(a=>a*Math.PI/180);
      const pts = axes.map((v,i)=>{ const rr=r*v; return [cx+rr*Math.cos(ang[i]), cy+rr*Math.sin(ang[i])]});
      const grid=[0.33,0.66,1].map(g=>{ const gpts=ang.map(a=>`${cx+r*g*Math.cos(a)},${cy+r*g*Math.sin(a)}`); return `<polygon points="${gpts.join(' ')}" fill="none" stroke="rgba(255,255,255,.12)"/>`; }).join('');
      const poly=`<polygon points="${pts.map(p=>p.join(',')).join(' ')}" fill="rgba(79,156,255,.25)" stroke="var(--accent)"/>`;
      const labels=['Risco','Atenção','Velocidade'].map((t,i)=>{const rr=r*1.15,x=cx+rr*Math.cos(ang[i]),y=cy+rr*Math.sin(ang[i]);return `<text x="${x}" y="${y}" text-anchor="middle" font-size="10" fill="#cbd6ee">${t}</text>`}).join('');
      el.innerHTML = `<g>${grid}${poly}${labels}</g>`;
    }
    function updateTimer(){ timer.textContent = fmtTime(performance.now() - t0); raf = requestAnimationFrame(updateTimer); }

    // ------- Helpers -------
    function attentionLabel(p){
      if(p > 66) return 'Alta atenção e consistência.';
      if(p > 33) return 'Atenção moderada, algumas variações.';
      return 'Baixa atenção, respostas inconsistentes.';
    }

    // ------- Fluxo -------
    function start(){
      const n = (nameInput.value ?? '').trim(); if(!n){ alert('Por favor, informe seu nome.'); return; }
      player = n; step = 0; answers = []; times = [];
      intro.style.display = 'none'; result.style.display='none'; game.style.display = 'grid';
      render();
    }
    function render(){
      const total=scenarios.length, sc=scenarios[step];
      sceneImg.src = sc.img; stepText.textContent = `Pergunta ${step+1} de ${total}`;
      progressBar.style.width = `${((step)/total)*100}%`;
      topic.textContent = sc.topic; questionText.textContent = sc.q; options.innerHTML = '';
      sc.opt.forEach((o,idx)=>{ const id=`opt_${step}_${idx}`; const li=document.createElement('label'); li.className='opt'; li.setAttribute('for',id);
        const radio=document.createElement('input'); radio.type='radio'; radio.name='opt'; radio.id=id; radio.value=o.v; radio.addEventListener('change',()=>btnNext.disabled=false);
        const span=document.createElement('div'); span.innerHTML = `<b>${idx+1})</b> ${o.t}`; li.appendChild(radio); li.appendChild(span); options.appendChild(li);
      });
      btnNext.disabled = true; btnBack.disabled = (step===0); cancelAnimationFrame(raf); t0 = performance.now(); updateTimer();
    }
    function next(){
      const sel = document.querySelector("input[name='opt']:checked"); if(!sel){ alert('Selecione uma opção para continuar.'); return; }
      times.push(performance.now()-t0); answers.push(parseInt(sel.value,10)); step++; (step < scenarios.length) ? render() : finish();
    }
    function back(){ if(step===0) return; step--; render(); }

    // ------- Métricas -------
    function calc(){
      const n=answers.length, avg = answers.reduce((a,b)=>a+b,0)/n;
      const diffs=[]; for(let i=1;i<n;i++) diffs.push(Math.abs(answers[i]-answers[i-1]));
      const avgDiff = diffs.length ? (diffs.reduce((a,b)=>a+b,0)/diffs.length) : 0;
      const attentionPct = Math.max(0, 100 - (avgDiff/4)*100);
      const avgMs = times.reduce((a,b)=>a+b,0)/n; const s = avgMs/1000;
      const speedPct = Math.max(0, Math.min(100, 100*((45 - Math.min(45, Math.max(6, s))) / (45-6))));
      const riskPct = Math.max(0, Math.min(100, ((avg-1)/4)*100));
      return { avg, attentionPct, speedPct, riskPct, avgDiff, s };
    }
    function badgeRisk(avg){ if(avg <= 2) return {t:'Perfil Conservador', c:'var(--good)'}; if(avg <= 3.5) return {t:'Perfil Moderado', c:'var(--warn)'}; return {t:'Perfil Ousado', c:'var(--bad)'}; }

    function finish(){
      cancelAnimationFrame(raf); game.style.display='none'; result.style.display='block';
      const {avg, attentionPct, speedPct, riskPct, avgDiff, s} = calc(); const badge = badgeRisk(avg);

      thanks.textContent = `Obrigado, ${player}! Aqui está seu resultado.`;
      const attTxt = attentionLabel(attentionPct);
      summary.innerHTML = `Média das respostas: <b>${avg.toFixed(2)}</b> — <b style="color:${badge.c}">${badge.t}</b>.<br>
        Consistência: <b>${attTxt}</b> (variação média ${avgDiff.toFixed(2)}). Tempo médio por pergunta: <b>${s.toFixed(1)}s</b>.`;

      drawDonut('gaugeRisk', riskPct, badge.c);
      drawDonut('gaugeAttention', attentionPct, attentionPct>66? 'var(--good)' : attentionPct>33? 'var(--warn)' : 'var(--bad)');
      drawDonut('gaugeSpeed', speedPct, speedPct>66? 'var(--good)' : speedPct>33? 'var(--warn)' : 'var(--bad)');
      drawRadar('radar', [ riskPct/100, attentionPct/100, speedPct/100 ]);

      // Respostas
      answersList.innerHTML = '';
      scenarios.forEach((sc,i)=>{
        const li = document.createElement('li');
        const chosen = answers[i];
        const o = sc.opt.find(o=>o.v===chosen) || sc.opt[0];
        li.innerHTML = `<b>${sc.q}</b><br><span style="color:var(--muted)">Sua resposta: ${o.t} <i>(valor ${chosen})</i></span>`;
        answersList.appendChild(li);
      });

      // Export CSV (mantém % e adiciona descrição)
      btnCSV.onclick = function(){
        const header = ['nome','media','perfil','risco(0-100)','atencao(0-100)','perfil_atencao','velocidade(0-100)','tempo_medio_s','respostas'];
        const row = [player, avg.toFixed(2), badge.t, riskPct.toFixed(0), attentionPct.toFixed(0), attTxt, speedPct.toFixed(0), s.toFixed(1), JSON.stringify(answers)];
        const csv = header.join(',') + '\n' + row.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',');
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download='resultado_rac03_jogo.csv'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
      };

      // [GAS] Envio sem preflight (envia PerfilAtencao como TEXTO)
      const GAS_URL = 'https://script.google.com/macros/s/AKfycbz7X4lwyYjhAUTjl3k3DKQZjv-vuR2m86b8wOz82qw1FDfqY2-jxzwlP5sHaGPLHnyGKQ/exec';
      const body = new URLSearchParams({
        nome: player,
        media: avg.toFixed(2),
        perfil: badge.t,
        risco: String(Math.round(riskPct)),
        PerfilAtencao: attTxt,           // <— campo esperado pelo GAS como texto
        atencao: String(Math.round(attentionPct)), // opcional: mantém % para consulta
        velocidade: String(Math.round(speedPct)),
        tempoMedioSeg: s.toFixed(1),
        respostas: JSON.stringify(answers)
      });
      fetch(GAS_URL, { method:'POST', body })
        .then(async r => { const txt = await r.text(); try{ return JSON.parse(txt);}catch{ return { raw: txt }; } })
        .then(data => console.log('Sheets:', data))
        .catch(err => console.warn('Falha backend', err));

      // Reiniciar
      btnReiniciar.onclick = ()=>{ intro.style.display='block'; result.style.display='none'; };
    }

    // ------- Eventos -------
    btnStart.addEventListener('click', start);
    btnDemo.addEventListener('click', ()=>{ nameInput.value = 'Participante Demo'; start(); });
    btnNext.addEventListener('click', next);
    btnBack.addEventListener('click', back);
    document.addEventListener('keydown', (e)=>{
      if(game.style.display !== 'grid') return;
      if(e.key>='1' && e.key<='4'){
        const i = parseInt(e.key,10)-1; const input = document.querySelectorAll("input[name='opt']")[i];
        if(input){ input.checked = true; btnNext.disabled = false; }
      }
      if(e.key==='Enter') next();
      if(e.key==='Escape') back();
    });
  })();
  </script>
</body>
</html>
